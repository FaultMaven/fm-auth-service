# FaultMaven Auth Service - Enterprise Edition
# Production Environment Configuration Template
#
# SECURITY WARNING:
# - Never commit production secrets to version control
# - Use secrets management service (AWS Secrets Manager, HashiCorp Vault, etc.)
# - Rotate secrets regularly
# - Use strong, randomly generated values
#
# Instructions:
# 1. DO NOT copy this file directly to .env in production
# 2. Use your secrets management system to inject these values
# 3. Audit all access to production secrets
# 4. Enable encryption at rest and in transit

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================

# PostgreSQL connection settings
# CRITICAL: Use managed database service (AWS RDS, Google Cloud SQL, etc.)
POSTGRES_HOST=<CHANGE_ME_production_db_host>
POSTGRES_PORT=5432
POSTGRES_DB=faultmaven_auth_prod
POSTGRES_USER=<CHANGE_ME_db_user>
POSTGRES_PASSWORD=<CHANGE_ME_use_secrets_manager>

# SSL/TLS for database connections (REQUIRED in production)
POSTGRES_SSL_MODE=require
POSTGRES_SSL_CERT=/path/to/ssl/client-cert.pem
POSTGRES_SSL_KEY=/path/to/ssl/client-key.pem
POSTGRES_SSL_ROOT_CERT=/path/to/ssl/ca-cert.pem

# Connection pooling
POSTGRES_POOL_SIZE=20
POSTGRES_MAX_OVERFLOW=10
POSTGRES_POOL_TIMEOUT=30

# ==============================================================================
# REDIS CONFIGURATION
# ==============================================================================

# Redis connection settings
# CRITICAL: Use managed Redis service (AWS ElastiCache, Redis Cloud, etc.)
REDIS_HOST=<CHANGE_ME_production_redis_host>
REDIS_PORT=6379
REDIS_PASSWORD=<CHANGE_ME_use_secrets_manager>
REDIS_DB=0

# Redis SSL/TLS (REQUIRED in production)
REDIS_SSL=true
REDIS_SSL_CERT_REQS=required
REDIS_SSL_CA_CERTS=/path/to/ssl/ca-cert.pem

# Redis connection pooling
REDIS_MAX_CONNECTIONS=50

# ==============================================================================
# JWT AUTHENTICATION
# ==============================================================================

# JWT secret key (CRITICAL - must be strong and unique)
# MUST be stored in secrets manager, not in environment files
# Generate with: openssl rand -hex 64
JWT_SECRET_KEY=<CHANGE_ME_use_secrets_manager_64_char_min>

# JWT algorithm (HS256 or RS256 for production)
JWT_ALGORITHM=HS256

# Token expiration times (production-hardened)
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7

# Token rotation policy
ENABLE_TOKEN_ROTATION=true
MAX_REFRESH_TOKEN_REUSE=0

# ==============================================================================
# SAML SSO CONFIGURATION
# ==============================================================================

# SAML Service Provider settings
SAML_ENTITY_ID=https://auth.faultmaven.com
SAML_ACS_URL=https://auth.faultmaven.com/api/v1/enterprise/sso/saml/acs
SAML_SLO_URL=https://auth.faultmaven.com/api/v1/enterprise/sso/saml/slo
SAML_METADATA_URL=https://auth.faultmaven.com/api/v1/enterprise/sso/saml/metadata

# SAML certificates (stored in secrets manager)
SAML_CERT_FILE=/var/secrets/saml/sp-cert.pem
SAML_KEY_FILE=/var/secrets/saml/sp-key.pem

# SAML security settings
SAML_SIGN_REQUESTS=true
SAML_REQUIRE_SIGNED_ASSERTIONS=true
SAML_REQUIRE_ENCRYPTED_ASSERTIONS=true

# ==============================================================================
# APPLICATION CONFIGURATION
# ==============================================================================

# Environment mode
ENVIRONMENT=production

# Logging (use structured logging in production)
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_OUTPUT=stdout

# CORS settings (specific domains only)
CORS_ORIGINS=https://app.faultmaven.com,https://admin.faultmaven.com

# Service configuration
SERVICE_PORT=8000
SERVICE_HOST=0.0.0.0

# External port mapping
AUTH_SERVICE_PORT=8001

# ==============================================================================
# SECURITY SETTINGS
# ==============================================================================

# Password requirements (production-hardened)
PASSWORD_MIN_LENGTH=12
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_DIGITS=true
PASSWORD_REQUIRE_SPECIAL_CHARS=true
BCRYPT_ROUNDS=12

# Rate limiting (aggressive for production)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=30
RATE_LIMIT_BURST=10

# Session security
SESSION_TIMEOUT_MINUTES=30
MAX_CONCURRENT_SESSIONS=3
ENABLE_SESSION_FINGERPRINTING=true

# Account security
ENABLE_MFA=true
MAX_LOGIN_ATTEMPTS=5
ACCOUNT_LOCKOUT_DURATION_MINUTES=30

# IP whitelisting (optional)
IP_WHITELIST_ENABLED=false
IP_WHITELIST=

# ==============================================================================
# EMAIL CONFIGURATION
# ==============================================================================

# SMTP settings (use transactional email service)
SMTP_HOST=<CHANGE_ME_smtp_host>
SMTP_PORT=587
SMTP_USER=<CHANGE_ME_use_secrets_manager>
SMTP_PASSWORD=<CHANGE_ME_use_secrets_manager>
SMTP_FROM_EMAIL=noreply@faultmaven.com
SMTP_FROM_NAME=FaultMaven
SMTP_USE_TLS=true

# ==============================================================================
# MONITORING & OBSERVABILITY
# ==============================================================================

# Sentry error tracking
SENTRY_DSN=<CHANGE_ME_sentry_dsn>
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=<CHANGE_ME_otel_endpoint>
OTEL_SERVICE_NAME=fm-auth-service-enterprise
OTEL_TRACES_SAMPLER=traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# Health checks
HEALTH_CHECK_ENDPOINT=/health
READINESS_CHECK_ENDPOINT=/ready

# ==============================================================================
# BACKUP & DISASTER RECOVERY
# ==============================================================================

# Automated backup settings
ENABLE_AUTO_BACKUP=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=<CHANGE_ME_backup_bucket>

# ==============================================================================
# COMPLIANCE & AUDIT
# ==============================================================================

# Audit logging
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_RETENTION_DAYS=365
AUDIT_LOG_S3_BUCKET=<CHANGE_ME_audit_bucket>

# Data retention
USER_DATA_RETENTION_DAYS=730
SESSION_DATA_RETENTION_DAYS=90

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================

# Production features
ENABLE_SSO=true
ENABLE_TEAM_MANAGEMENT=true
ENABLE_AUDIT_LOGGING=true
ENABLE_API_DOCS=false

# Development features (DISABLED in production)
RELOAD=false
SQL_ECHO=false
DEBUG=false

# ==============================================================================
# HIGH AVAILABILITY
# ==============================================================================

# Load balancer health check
LB_HEALTH_CHECK_PATH=/health
LB_HEALTH_CHECK_INTERVAL=10

# Graceful shutdown
GRACEFUL_SHUTDOWN_TIMEOUT=30

# Worker configuration (for multiple Uvicorn workers)
WORKERS=4
WORKER_CONNECTIONS=1000
KEEPALIVE=5
